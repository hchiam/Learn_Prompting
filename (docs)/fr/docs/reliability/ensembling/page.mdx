export const metadata = { sidebar_position: 5, title: "üü° Ensembles de Prompts" };

# üü° Ensembles de Prompts

L'ensemblage de prompts est le concept d'utiliser plusieurs prompts diff√©rents pour essayer de r√©pondre √† la m√™me question. Il existe de nombreuses approches diff√©rentes pour cela.

## DiVeRSe

DiVeRSe(@li2022advance) ("**Di**verse **Ve**rifier on **R**easoning **S**t**e**ps") est une m√©thode qui am√©liore la fiabilit√© des r√©ponses de trois mani√®res. Elle le fait en :

1) utilisant plusieurs prompts pour g√©n√©rer des compl√©tions diverses,
2) utilisant un v√©rificateur pour distinguer les bonnes r√©ponses des mauvaises, et 
3) utilisant un v√©rificateur pour v√©rifier l'exactitude des √©tapes de raisonnement.

<div style={{ textAlign: "center" }}>
  <Image
    src="/docs/assets/reliability/diverse.webp"
    width={824}
    height={300}
    style={{ width: "750px", margin: "auto" }}
  />
</div>

<div style={{ textAlign: "center" }}>DiVeRSe (Li et al.)</div>

### Prompts Divers

DiVeRSe utilise 5 prompts diff√©rents pour une entr√©e donn√©e. Pour construire chaque prompt, ils √©chantillonnent al√©atoirement quelques exemples de l'ensemble d'entra√Ænement. Voici un exemple d'un tel prompt few-shot (k=2), avec des exemples tir√©s du [benchmark GSM8K](https://raw.githubusercontent.com/openai/grade-school-math/master/grade_school_math/data/train.jsonl)(@cobbe2021training). En pratique, DiVeRSe utilise 5 exemples dans les prompts pour ce benchmark.

```
Q: Natalia a vendu des pinces √† 48 de ses amis en avril, puis elle a vendu moiti√© moins de pinces en mai. Combien de pinces Natalia a-t-elle vendues au total en avril et mai ?
R: Natalia a vendu 48/2 = 24 pinces en mai.
Natalia a vendu 48+24 = 72 pinces au total en avril et mai.
#### 72
Q: Weng gagne 12$ de l'heure pour du baby-sitting. Hier, elle a fait seulement 50 minutes de baby-sitting. Combien a-t-elle gagn√© ?
R: Weng gagne 12/60 = 0,2$ par minute.
En travaillant 50 minutes, elle a gagn√© 0,2 x 50 = 10$.
#### 10
Q: Betty √©conomise pour un nouveau portefeuille qui co√ªte 100$. Betty n'a que la moiti√© de l'argent dont elle a besoin. Ses parents ont d√©cid√© de lui donner 15$ √† cette fin, et ses grands-parents deux fois plus que ses parents. Combien d'argent Betty a-t-elle encore besoin pour acheter le portefeuille ?
R:
```

Apr√®s avoir g√©n√©r√© 5 prompts diff√©rents comme ci-dessus, DiVeRSe √©chantillonne 20 chemins de raisonnement pour chacun (temp√©rature = 0,5). Voici quelques exemples de compl√©tions du prompt ci-dessus. Notez que les r√©ponses ne sont pas toujours correctes.

```text {1-5}
Betty a 0,5*100 = 50$.
Puis elle re√ßoit 15$ de plus = 65$.
Puis elle re√ßoit 2*15 = 30$ de plus = 95$.
Elle a besoin de 100-95 = 5$ de plus.
#### 5
```

```text {1-5}
R: Betty a 0,5*100 = 50$.
Puis elle re√ßoit 15$ de plus = 65$.
Puis elle re√ßoit 2*15 = 30$ de plus = 95$.
Elle a besoin de 100-95 = 5$ de plus.
#### 5
```

√Ä ce stade, DiVeRSe a g√©n√©r√© 100 compl√©tions diff√©rentes.

### V√©rificateur de Vote

Maintenant, nous pourrions simplement prendre la r√©ponse majoritaire, comme le fait Self-Consistency(@mitchell2022enhancing).

Cependant, DiVeRSe propose une m√©thode beaucoup plus complexe, qu'ils appellent un _v√©rificateur de vote_.

Lors de l'utilisation, le v√©rificateur de vote est un processus en deux √©tapes. D'abord, le v√©rificateur (un r√©seau neuronal) attribue un score de 0 √† 1 √† chaque compl√©tion en fonction de sa probabilit√© d'√™tre correcte. Ensuite, la composante de 'vote' additionne tous les scores pour diff√©rentes r√©ponses et donne la r√©ponse finale.

#### Exemple

Voici un petit exemple. Supposons que nous ayons les compl√©tions suivantes pour le prompt `Combien font deux plus deux ?` :

```text {1-1}
4
```

```text {1-1}
deux + 2 = 5
```

```text {1-1}
Je pense que 2+2 = 6
```

```text {1-1}
deux plus deux = 4
```

```text {1-1}
C'est 5
```

Le v√©rificateur lira chaque compl√©tion et lui attribuera un score. Par exemple, il pourrait attribuer les scores : 0,9, 0,1, 0,2, 0,8, 0,3 respectivement. Ensuite, la composante de vote additionnera les scores pour chaque r√©ponse.

```
score(4) = 0,9 + 0,8 = 1,7
score(5) = 0,1 + 0,3 = 0,4
score(6) = 0,2
```

La r√©ponse finale est 4, car elle a le score le plus √©lev√©.

**Mais comment le v√©rificateur est-il entra√Æn√© ?**

Le v√©rificateur est entra√Æn√© avec une fonction de perte l√©g√®rement complexe, que je ne couvrirai pas ici. Lisez la section 3.3 de l'article pour plus de d√©tails(@li2022advance).

## Prompting Ask Me Anything (AMA)

<div style={{ textAlign: "center" }}>
  <Image
    src="/docs/assets/reliability/AMA_Prompting.webp"
    width={1313}
    height={469}
    style={{ width: "750px", margin: "auto" }}
  />
</div>

Le prompting Ask Me Anything (AMA)(@arora2022ama) est une approche similaire √† DiVeRSe. Cependant, son √©tape de prompts multiples et son √©tape d'agr√©gation de r√©ponses diff√®rent significativement. L'id√©e centrale d'AMA est d'utiliser un LLM pour g√©n√©rer plusieurs prompts, au lieu de simplement utiliser diff√©rents exemples few-shot.

### Prompts Multiples

AMA montre que vous pouvez prendre une question et la reformuler de plusieurs fa√ßons pour cr√©er diff√©rents prompts. Par exemple, supposons que vous r√©cup√©riez des informations sur des animaux sur divers sites web et que vous souhaitiez n'enregistrer que ceux qui vivent en Am√©rique du Nord. Construisons un prompt pour d√©terminer cela.

√âtant donn√© le passage suivant de Wikip√©dia :

```text
L'ours Kermode, parfois appel√© ours esprit (Ursus americanus kermodei), est une sous-esp√®ce de l'ours noir am√©ricain et vit dans les r√©gions c√¥ti√®res centrales et nord de la Colombie-Britannique, au Canada.
```

Vous pouvez formater cette t√¢che en un prompt comme ceci :

```text
La d√©claration suivante est-elle Vraie ou Fausse √©tant donn√© le contexte ?

Contexte : L'ours Kermode, parfois appel√© ours esprit (Ursus americanus kermodei), est une sous-esp√®ce de l'ours noir am√©ricain et vit dans les r√©gions c√¥ti√®res centrales et nord de la Colombie-Britannique, au Canada.
D√©claration : Cet animal vit en Am√©rique du Nord
R√©ponse :
```

C'est une formulation un peu √©trange. Pourquoi ne pas simplement utiliser le prompt plus simple suivant ?

```text
Contexte : L'ours Kermode, parfois appel√© ours esprit (Ursus americanus kermodei), est une sous-esp√®ce de l'ours noir am√©ricain et vit dans les r√©gions c√¥ti√®res centrales et nord de la Colombie-Britannique, au Canada.
Question : Cet animal vit-il en Am√©rique du Nord ?
```

En formulant la question de cette mani√®re sp√©ciale, nous pouvons g√©n√©rer diff√©rents prompts. Notre premi√®re √©tape ici sera de prendre la d√©claration `Cet animal vit en Am√©rique du Nord` et de la reformuler en diff√©rentes questions, qui demandent essentiellement la m√™me chose. Pour ce faire, nous passerons la d√©claration √† travers des prompts comme ceux de l'image ci-dessous.

<div style={{ textAlign: "center" }}>
  <Image
    src="/docs/assets/reliability/AMA_multiprompting.webp"
    width={1778}
    height={416}
    style={{ width: "800px", margin: "auto" }}
  />
</div>

Cela pourrait produire :

1. L'animal vivait-il en Am√©rique du Nord ?
2. L'animal vit-il en Am√©rique du Nord ?
3. O√π vit l'animal ?

L'id√©e derri√®re cela est de cr√©er diff√©rentes _vues_ de la t√¢che. Nous appliquons ensuite chacune au contexte donn√© comme ceci :

```text
Contexte : L'ours Kermode, parfois appel√© ours esprit (Ursus americanus kermodei), est une sous-esp√®ce de l'ours noir am√©ricain et vit dans les r√©gions c√¥ti√®res centrales et nord de la Colombie-Britannique, au Canada.
Question : L'animal vivait-il en Am√©rique du Nord ?
```

Ensuite, nous pouvons g√©n√©rer des r√©ponses pour chacune :

1. `Oui, il y vivait`
2. `Oui, il y vit`
3. `Am√©rique du Nord`

Ce sont des r√©ponses _interm√©diaires_. Nous devons les associer √† des √©tiquettes de t√¢che (par exemple, Oui ou Non).

Nous pouvons le faire en passant les r√©ponses interm√©diaires √† travers un prompt comme celui-ci :

```text
S√©lectionnez la cat√©gorie correcte.

"Cat√©gories" :
- Oui, Am√©rique du Nord
- Non, pas en Am√©rique du Nord

"Oui, il y vivait" correspond √† la cat√©gorie :
```

Maintenant, nous pouvons obtenir nos r√©ponses de sortie.

1. `Oui, Am√©rique du Nord`
2. `Oui, Am√©rique du Nord`
3. `Oui, Am√©rique du Nord`

Ici, elles sont toutes d'accord, donc nous pouvons simplement prendre la premi√®re r√©ponse. Cependant, si elles √©taient en d√©saccord, nous pourrions utiliser l'√©tape d'agr√©gation AMA pour obtenir une r√©ponse finale.

### Agr√©gation des R√©ponses

AMA utilise une strat√©gie tr√®s complexe pour agr√©ger les r√©ponses (plus que DiVeRSe) au lieu de simplement prendre la r√©ponse majoritaire. Pour comprendre pourquoi la r√©ponse majoritaire peut √™tre un mauvais choix, consid√©rons deux des questions que nous avons g√©n√©r√©es pr√©c√©demment :

1. L'animal vivait-il en Am√©rique du Nord ?
2. L'animal vit-il en Am√©rique du Nord ?

Elles sont extr√™mement similaires, donc elles g√©n√©reront probablement le m√™me r√©sultat. Comme les questions sont si similaires, elles biaiseront effectivement le r√©sultat final. Pour r√©soudre ce probl√®me, AMA s'appuie sur une supervision faible et des math√©matiques complexes afin d'estimer les d√©pendances entre les diff√©rents prompts qu'il cr√©e, puis utilise cela pour les pond√©rer de mani√®re appropri√©e.

Ainsi, pour les trois questions que nous avons g√©n√©r√©es, il pourrait attribuer des poids de 25%, 25% et 50%, puisque les deux premi√®res sont si similaires.

Bien que la strat√©gie d'agr√©gation d'AMA soit puissante, elle est si compliqu√©e que je ne la couvrirai pas ici. Lisez la section 3.4 de l'article pour plus de d√©tails(@arora2022ama).

### R√©sultats

- Avec cette strat√©gie de prompting, AMA est capable d'utiliser GPT-J-6B(@wange2021gptj) pour surpasser GPT-3.

- AMA est meilleur sur les questions o√π le contexte donn√© contient la r√©ponse.

## √Ä retenir

Les m√©thodes d'ensemblage sont tr√®s puissantes. Elles peuvent √™tre utilis√©es pour am√©liorer les performances de n'importe quel mod√®le, et peuvent √™tre utilis√©es pour am√©liorer les performances d'un mod√®le sur une t√¢che sp√©cifique.

En pratique, le vote majoritaire devrait √™tre votre strat√©gie de pr√©dilection.
