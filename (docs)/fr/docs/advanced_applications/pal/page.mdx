export const metadata = { sidebar_position: 4, title: "üü° Le Code comme Raisonnement" };

# üü° Le Code comme Raisonnement

Les [Program-aided Language Models (PAL)](https://reasonwithpal.com)(@gao2022pal) sont un autre exemple de syst√®me MRKL. 
Lorsqu'une question leur est pos√©e, les PAL sont capables d'**√©crire du code** qui r√©sout cette question. Ils envoient le 
code √† un environnement d'ex√©cution programmatique pour obtenir le r√©sultat. PAL fonctionne diff√©remment de CoT ; le raisonnement interm√©diaire de PAL 
est du code, tandis que celui de CoT est en langage naturel.

<div style={{ textAlign: "center" }}>
  <Image
    src="/docs/assets/advanced/pal.webp"
    width={1380}
    height={1240}
    style={{ width: "500px", margin: "auto" }}
  />
</div>

<div style={{ textAlign: "center" }}>Exemple PAL (Gao et al.)</div>

Un point important √† noter est que PAL entrelace en r√©alit√© le langage naturel (NL) et le code.
Dans l'image ci-dessus, en bleu se trouve le raisonnement en langage naturel que PAL g√©n√®re. Bien que 
ce ne soit pas montr√© dans l'image, PAL g√©n√®re en fait '\#' avant chaque ligne de raisonnement NL, 
afin qu'elles soient interpr√©t√©es comme des commentaires par l'environnement d'ex√©cution.

## Exemple

Examinons un exemple de PAL r√©solvant une question math√©matique. J'utilise un prompt √† 3 exemples,
qui est une version simplifi√©e de [celui-ci](https://github.com/reasoning-machines/pal/blob/main/pal/prompt/math_prompts.py)(@gao2022pal).

Je vais utiliser langchain, un package Python pour cha√Æner les fonctionnalit√©s LLM. 
Tout d'abord, quelques installations sont n√©cessaires :

```python
!pip install langchain==0.0.26
!pip install openai
from langchain.llms import OpenAI
import os
os.environ["OPENAI_API_KEY"] = "sk-VOTRE_CLE_ICI"
```

Ensuite, nous pouvons cr√©er une instance de GPT-3 davinci-002 (un appel API se produit lorsque nous utilisons cet objet)

```python
llm = OpenAI(model_name='text-davinci-002', temperature=0)
```

Voici le prompt √† quelques exemples :

```python
MATH_PROMPT = '''
Q: Il y avait neuf ordinateurs dans la salle des serveurs. Cinq ordinateurs suppl√©mentaires ont √©t√© install√©s chaque jour, du lundi au jeudi. Combien y a-t-il maintenant d'ordinateurs dans la salle des serveurs ?

# solution en Python:
"""Il y avait neuf ordinateurs dans la salle des serveurs. Cinq ordinateurs suppl√©mentaires ont √©t√© install√©s chaque jour, du lundi au jeudi. Combien y a-t-il maintenant d'ordinateurs dans la salle des serveurs ?"""
computers_initial = 9
computers_per_day = 5
num_days = 4  # 4 jours entre lundi et jeudi
computers_added = computers_per_day * num_days
computers_total = computers_initial + computers_added
result = computers_total
return result


Q: Shawn a cinq jouets. Pour No√´l, il a re√ßu deux jouets de sa m√®re et deux de son p√®re. Combien de jouets a-t-il maintenant ?

# solution en Python:
"""Shawn a cinq jouets. Pour No√´l, il a re√ßu deux jouets de sa m√®re et deux de son p√®re. Combien de jouets a-t-il maintenant ?"""
toys_initial = 5
mom_toys = 2
dad_toys = 2
total_received = mom_toys + dad_toys
total_toys = toys_initial + total_received
result = total_toys


Q: Jason avait 20 sucettes. Il en a donn√© quelques-unes √† Denny. Maintenant Jason a 12 sucettes. Combien de sucettes Jason a-t-il donn√©es √† Denny ?

# solution en Python:
"""Jason avait 20 sucettes. Il en a donn√© quelques-unes √† Denny. Maintenant Jason a 12 sucettes. Combien de sucettes Jason a-t-il donn√©es √† Denny ?"""
jason_lollipops_initial = 20
jason_lollipops_after = 12
denny_lollipops = jason_lollipops_initial - jason_lollipops_after
result = denny_lollipops

Q: {question}

# solution en Python:
'''
```

Maintenant, nous pouvons passer le prompt combin√© √† GPT-3.

```python
llm_out = llm(MATH_PROMPT.format(question=question))
print(llm_out)
```

La sortie est :

<pre>
  <span className="bluegreen-highlight">
    Emma a pris un vol de 60 minutes vers Seattle. Elle a ensuite pris un train
    pendant 2 heures jusqu'√† Portland, puis un bus pendant 30 minutes jusqu'√† Vancouver.
    Combien de temps lui a-t-il fallu pour arriver √† Vancouver ?
    <br />
    <br />
    plane_ride = 60
    <br />
    train_ride = 2 * 60 # 2 heures en minutes
    <br />
    bus_ride = 30
    <br />
    total_time = plane_ride + train_ride + bus_ride
    <br />
    result = total_time
  </span>
</pre>

Enfin, nous pouvons passer ce code √† un environnement d'ex√©cution Python pour obtenir la r√©ponse :

```python
exec(llm_out)
print(result)
```

La sortie est **210**, ce qui est correct.

Voir le notebook Jupyter pour cet exemple [ici](https://github.com/trigaten/Learn_Prompting/tree/main/docs/code_examples/PAL.ipynb).

## Plus d'informations

Voir aussi [l'exemple colab de PAL](https://colab.research.google.com/drive/1u4_RsdI0E79PCMDdcPiJUzYhdnjoXeXc?usp=sharing#scrollTo=Ba0ycacK4i1V).
